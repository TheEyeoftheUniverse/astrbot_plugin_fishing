{% extends "layout.html" %}

{% block title %}钓鱼区域 - 钓鱼游戏{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h2 class="mb-0">
            <i class="fas fa-map-marked-alt"></i> 钓鱼区域管理
        </h2>
        <p class="text-muted mt-2">切换到不同的钓鱼区域，探索更多鱼类</p>
    </div>
</div>

<!-- 当前区域信息 -->
{% if current_zone %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-primary">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-location-arrow"></i> 当前区域</h5>
            </div>
            <div class="card-body">
                <h4>{{ current_zone.name }}</h4>
                <p class="text-muted mb-2">{{ current_zone.description }}</p>
                {% if current_zone.required_pass %}
                    <div class="alert alert-info mb-0">
                        <i class="fas fa-ticket-alt"></i> 需要通行证：<strong>{{ current_zone.required_pass }}</strong>
                    </div>
                {% else %}
                    <div class="alert alert-success mb-0">
                        <i class="fas fa-check-circle"></i> 无需通行证，自由进入
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="row mb-4">
    <div class="col-12">
        <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle"></i> 您当前没有在任何钓鱼区域
        </div>
    </div>
</div>
{% endif %}

<!-- 所有可用区域 -->
<div class="row mb-4">
    <div class="col-12">
        <h4><i class="fas fa-globe"></i> 所有钓鱼区域</h4>
    </div>
</div>

<div class="row g-4">
    {% for zone in all_zones %}
    <div class="col-md-6 col-lg-4">
        <div class="card h-100 {% if zone.is_current %}border-primary{% endif %} d-flex flex-column">
            <div class="card-header {% if zone.is_current %}bg-primary text-white{% else %}bg-secondary text-white{% endif %}">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">{{ zone.name }}</h5>
                    {% if zone.is_current %}
                        <span class="badge bg-light text-primary">
                            <i class="fas fa-check-circle"></i> 当前
                        </span>
                    {% endif %}
                </div>
            </div>
            <div class="card-body d-flex flex-column">
                <p class="card-text" style="min-height: 60px;">{{ zone.description }}</p>
                
                <div class="mt-auto">
                    {% if zone.required_pass %}
                        <div class="alert alert-warning small mb-3">
                            <i class="fas fa-ticket-alt"></i> 需要：{{ zone.required_pass }}
                        </div>
                    {% else %}
                        <div class="alert alert-success small mb-3">
                            <i class="fas fa-unlock"></i> 自由进入
                        </div>
                    {% endif %}
                    
                    {% if zone.is_current %}
                        <button class="btn btn-secondary w-100" disabled>
                            <i class="fas fa-check"></i> 已在此区域
                        </button>
                    {% else %}
                        <button class="btn btn-primary w-100" onclick="changeZone({{ zone.id }}, '{{ zone.name }}')">
                            <i class="fas fa-arrow-right"></i> 前往此区域
                        </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- 提示信息 -->
<div class="row mt-4">
    <div class="col-12">
        <div class="alert alert-info">
            <h5><i class="fas fa-info-circle"></i> 温馨提示</h5>
            <ul class="mb-0">
                <li>不同区域可以钓到不同稀有度的鱼类</li>
                <li>某些区域需要特定的通行证才能进入</li>
                <li>每日刷新时，如果没有通行证或通行证被消耗完，会被移动回新手区域</li>
                <li>购买永久通行证可以永久留在高级区域</li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
async function changeZone(zoneId, zoneName) {
    const formData = new FormData();
    formData.append('zone_id', zoneId);
    
    try {
        const response = await fetch('{{ url_for("player_bp.change_zone") }}', {
            method: 'POST',
            body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
            showToast(data.message, 'success');
            setTimeout(() => location.reload(), 800);
        } else {
            showToast(data.message, 'error');
        }
    } catch (error) {
        showToast('网络错误，请稍后重试', 'error');
    }
}
</script>
{% endblock %}
